<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–∫–∞–∑–æ–≤</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
--primary: #34d399;
--primary-dark: #10b981;
--primary-light: #6ee7b7;
--success: #34d399;
--warning: #fbbf24;
--danger: #f87171;
--info: #22d3ee;
--purple: #a78bfa;
--bg-primary: #020617;
--bg-secondary: #1e293b;
--bg-tertiary: #334155;
--text-primary: #f8fafc;
--text-secondary: #94a3b8;
--text-tertiary: #64748b;
--border: #334155;
--border-light: #475569;
--shadow: 0 4px 6px -1px rgb(0 0 0 / 0.5);
--shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5);
--transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
--radius: 16px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, var(--bg-primary) 0%, #064e3b 100%);
color: var(--text-primary);
min-height: 100vh;
padding-bottom: 40px;
}
.container { max-width: 1800px; margin: 0 auto; padding: 24px; }
.dashboard-header {
text-align: center;
margin-bottom: 32px;
padding: 32px 24px;
background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
backdrop-filter: blur(10px);
border-radius: var(--radius);
box-shadow: var(--shadow-lg), 0 0 25px rgba(52, 211, 153, 0.15);
color: white;
border: 1px solid var(--border);
}
.dashboard-header h1 {
font-size: 2rem;
margin-bottom: 8px;
display: flex;
justify-content: center;
align-items: center;
gap: 12px;
}
.dashboard-header h1 i { color: var(--primary); }
.dashboard-header p { color: var(--text-secondary); }
.upload-area {
border: 2px dashed var(--border-light);
border-radius: var(--radius);
padding: 48px 32px;
text-align: center;
background: rgba(30, 41, 59, 0.5);
cursor: pointer;
transition: var(--transition);
margin-bottom: 32px;
}
.upload-area:hover, .upload-area.dragover {
border-color: var(--primary);
background: rgba(30, 41, 59, 0.8);
transform: translateY(-2px);
}
.upload-area i { font-size: 56px; color: var(--primary); margin-bottom: 16px; display: block; }
.upload-area h2 { font-size: 1.4rem; margin-bottom: 8px; }
.upload-area p { color: var(--text-secondary); }
.upload-area input[type="file"] { display: none; }
.summary-cards {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
gap: 20px;
margin-bottom: 32px;
}
.card {
background: var(--bg-secondary);
border-radius: var(--radius);
padding: 24px;
transition: var(--transition);
display: flex;
align-items: center;
gap: 16px;
border: 1px solid var(--border);
}
.card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); border-color: var(--primary); }
.card-icon {
width: 64px; height: 64px; border-radius: 16px;
display: flex; align-items: center; justify-content: center;
font-size: 26px; background: rgba(52, 211, 153, 0.1); color: var(--primary);
}
.card-content h3 { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 4px; }
.value { font-size: 1.75rem; font-weight: 700; color: var(--text-primary); }
.subtitle { font-size: 0.85rem; color: var(--text-tertiary); }
.charts-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
gap: 24px;
margin-bottom: 32px;
}
.chart-box {
background: var(--bg-secondary);
border-radius: var(--radius);
padding: 24px;
border: 1px solid var(--border);
position: relative;
min-width: 300px;
min-height: 300px;
transition: box-shadow 0.3s;
}
.chart-box:hover { box-shadow: var(--shadow-lg); border-color: var(--primary); }
.chart-box.h2 {
font-size: 1.2rem;
font-weight: 600;
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
padding-bottom: 16px;
border-bottom: 1px solid var(--border);
cursor: move;
}
.chart-box h2 i { color: var(--primary); }
.chart-container {
position: relative;
min-height: 250px;
}
.widget-controls {
position: absolute;
top: 12px;
right: 12px;
display: flex;
gap: 6px;
opacity: 0;
transition: opacity 0.2s;
z-index: 10;
}
.chart-box:hover .widget-controls { opacity: 1; }
.control-btn {
width: 28px; height: 28px; border-radius: 6px; border: none;
background: var(--bg-tertiary); color: var(--text-secondary);
cursor: pointer; display: flex; align-items: center; justify-content: center;
}
.control-btn:hover { background: var(--primary); color: var(--bg-primary); }
.resize-handle {
position: absolute;
width: 16px;
height: 16px;
background: var(--primary);
border-radius: 50%;
opacity: 0;
transition: opacity 0.2s;
z-index: 20;
cursor: se-resize;
}
.chart-box:hover .resize-handle { opacity: 0.8; }
.resize-handle:hover { opacity: 1; transform: scale(1.2); }
.resize-handle.se { bottom: 8px; right: 8px; }
.resize-handle.sw { bottom: 8px; left: 8px; cursor: sw-resize; }
.resize-handle.ne { top: 8px; right: 8px; cursor: ne-resize; }
.resize-handle.nw { top: 8px; left: 8px; cursor: nw-resize; }
.calendar-widget {
background: var(--bg-secondary);
border-radius: var(--radius);
padding: 24px;
border: 1px solid var(--border);
position: relative;
min-width: 300px;
min-height: 400px;
}
.calendar-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
padding-bottom: 16px;
border-bottom: 1px solid var(--border);
}
.calendar-title { font-size: 1.2rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
.calendar-title i { color: var(--primary); }
.calendar-stats {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
margin-bottom: 20px;
}
.stat-item {
background: var(--bg-tertiary);
padding: 14px;
border-radius: 12px;
text-align: center;
border: 1px solid var(--border);
}
.stat-value { font-size: 1.5rem; font-weight: 700; color: var(--primary); }
.stat-label { font-size: 0.85rem; color: var(--text-secondary); }
.calendar-grid {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 6px;
}
.calendar-day-header {
text-align: center;
font-size: 0.8rem;
font-weight: 600;
color: var(--text-tertiary);
padding: 8px 4px;
}
.calendar-day {
aspect-ratio: 1;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
border-radius: 10px;
font-size: 0.9rem;
font-weight: 500;
border: 2px solid transparent;
position: relative;
}
.calendar-day.weekend { background: rgba(248, 113, 113, 0.1); color: var(--danger); }
.calendar-day.holiday { background: rgba(251, 191, 36, 0.15); color: var(--warning); }
.calendar-day.loaded {
background: linear-gradient(135deg, rgba(52, 211, 153, 0.3), rgba(16, 185, 129, 0.2));
color: var(--primary-light);
border-color: var(--primary);
}
.calendar-day.loaded::after {
content: '8—á';
position: absolute;
bottom: 2px;
font-size: 0.65rem;
}
.calendar-day.today { border-color: var(--info); box-shadow: 0 0 10px rgba(34, 211, 238, 0.4); }
.calendar-day.empty { visibility: hidden; }
.calendar-legend {
display: flex;
gap: 16px;
margin-top: 16px;
padding-top: 12px;
border-top: 1px solid var(--border);
font-size: 0.85rem;
flex-wrap: wrap;
}
.legend-item { display: flex; align-items: center; gap: 6px; color: var(--text-secondary); }
.legend-box { width: 16px; height: 16px; border-radius: 6px; border: 2px solid; }
.legend-box.loaded { background: rgba(52, 211, 153, 0.3); border-color: var(--primary); }
.legend-box.weekend { background: rgba(248, 113, 113, 0.1); border-color: var(--danger); }
.legend-box.holiday { background: rgba(251, 191, 36, 0.15); border-color: var(--warning); }
.trend-controls { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
.trend-controls select {
padding: 8px 16px;
border: 1px solid var(--border);
border-radius: 10px;
background: var(--bg-tertiary);
color: var(--text-primary);
cursor: pointer;
}
.trend-legend { display: flex; gap: 20px; margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary); }
.trend-legend-item { display: flex; align-items: center; gap: 6px; }
.trend-legend-color { width: 12px; height: 12px; border-radius: 3px; }
.trend-legend-color.up { background: var(--success); }
.trend-legend-color.down { background: var(--danger); }
.progress-group { margin-bottom: 20px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border); }
.progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
.progress-title { font-weight: 500; }
.progress-value { color: var(--text-secondary); }
.progress { height: 12px; background: var(--bg-primary); border-radius: 6px; overflow: hidden; border: 1px solid var(--border); }
.progress-fill { height: 100%; border-radius: 6px; transition: width 0.6s; box-shadow: 0 0 10px currentColor; }
.history-section {
background: var(--bg-secondary);
border-radius: var(--radius);
padding: 24px;
margin-bottom: 32px;
border: 1px solid var(--border);
}
.history-section h2 { font-size: 1.2rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.reset-button {
background: linear-gradient(135deg, var(--danger), #b91c1c);
color: white;
border: none;
padding: 10px 20px;
border-radius: 10px;
cursor: pointer;
display: inline-flex;
align-items: center;
gap: 8px;
}
.history-list { display: flex; flex-direction: column; gap: 12px; }
.history-item {
display: flex;
align-items: center;
padding: 16px;
border-radius: 12px;
background: var(--bg-tertiary);
border: 1px solid transparent;
transition: var(--transition);
}
.history-item:hover { border-color: var(--primary); transform: translateX(4px); }
.history-item-icon {
width: 44px; height: 44px; border-radius: 12px;
background: rgba(52, 211, 153, 0.1); color: var(--primary);
display: flex; align-items: center; justify-content: center; margin-right: 16px;
}
.history-item-details { flex: 1; }
.history-item-details h4 { margin-bottom: 4px; }
.history-item-details p { color: var(--text-secondary); font-size: 0.85rem; }
.btn-remove {
background: none; border: none; color: var(--danger);
cursor: pointer; width: 36px; height: 36px; border-radius: 10px;
display: flex; align-items: center; justify-content: center;
}
.btn-remove:hover { background: rgba(248, 113, 113, 0.1); }
.data-table {
background: var(--bg-secondary);
border-radius: var(--radius);
padding: 24px;
margin-bottom: 32px;
border: 1px solid var(--border);
}
.data-table h2 { font-size: 1.2rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
.table-controls { display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 16px; }
.search-box { position: relative; flex: 1; max-width: 320px; }
.search-box i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); }
.search-box input {
width: 100%;
padding: 12px 14px 12px 40px;
border: 2px solid var(--border);
border-radius: 12px;
background: var(--bg-tertiary);
color: var(--text-primary);
}
.search-box input:focus { outline: none; border-color: var(--primary); }
.filters { display: flex; gap: 12px; flex-wrap: wrap; }
.filters select {
padding: 10px 16px;
border: 2px solid var(--border);
border-radius: 12px;
background: var(--bg-tertiary);
color: var(--text-primary);
cursor: pointer;
}
.filters select:focus { outline: none; border-color: var(--primary); }
.table-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
table thead { background: var(--bg-tertiary); }
table th { padding: 14px 16px; text-align: left; font-weight: 600; border-bottom: 2px solid var(--border); }
table td { padding: 14px 16px; border-bottom: 1px solid var(--border); color: var(--text-secondary); }
table tbody tr:hover { background: rgba(52, 211, 153, 0.05); }
.amount-cell { font-weight: 600; color: var(--primary); }
.comment-cell { text-align: center; }
.comment-btn {
width: 32px; height: 32px; border-radius: 8px;
border: 2px solid var(--border); background: var(--bg-tertiary);
color: var(--text-tertiary); cursor: pointer;
display: flex; align-items: center; justify-content: center;
position: relative;
}
.comment-btn:hover { border-color: var(--primary); color: var(--primary); }
.comment-btn.has-comment { background: rgba(52, 211, 153, 0.15); border-color: var(--primary); color: var(--primary); }
.comment-btn.has-comment::after {
content: ''; position: absolute; top: 4px; right: 4px;
width: 8px; height: 8px; background: var(--success); border-radius: 50%;
}
.comment-count {
position: absolute; top: -6px; right: -6px;
background: var(--danger); color: white; font-size: 10px;
padding: 2px 5px; border-radius: 10px;
}
.toast {
position: fixed; bottom: 24px; right: 24px;
background: var(--bg-secondary); color: var(--text-primary);
padding: 12px 20px; border-radius: 12px;
box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 10px;
z-index: 2000; animation: toastSlide 0.3s;
}
.toast.success { background: rgba(16, 185, 129, 0.9); color: white; }
.toast.error { background: rgba(239, 68, 68, 0.9); color: white; }
@keyframes toastSlide { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
.error-message {
background: rgba(239, 68, 68, 0.1);
border-left: 4px solid var(--danger);
padding: 16px 20px; border-radius: 12px;
margin: 20px 0; display: none;
}
.error-message.show { display: block; }
.error-message h3 { color: var(--danger); margin-bottom: 6px; }
footer { text-align: center; padding: 24px; color: var(--text-tertiary); margin-top: 20px; }
@media (max-width: 768px) {
.container { padding: 16px; }
.charts-container { grid-template-columns: 1fr; }
.summary-cards { grid-template-columns: 1fr; }
.calendar-stats { grid-template-columns: 1fr; }
.widget-controls { opacity: 1; }
.resize-handle { display: none; }
}
</style>
</head>
<body>
<div class="container">
<header class="dashboard-header">
<h1><i class="fas fa-chart-line"></i> –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–∫–∞–∑–æ–≤</h1>
<p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –∑–∞–∫–∞–∑–∞–º–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</p>
</header>
<div class="error-message" id="errorMessage">
<h3><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞</h3>
<ul id="errorList"></ul>
</div>
<div class="upload-area" id="dropZone">
<i class="fas fa-cloud-arrow-up"></i>
<h2>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</h2>
<p>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ ‚Ä¢ –§–æ—Ä–º–∞—Ç: <strong>.txt</strong></p>
<input type="file" id="fileInput" accept=".txt" hidden>
</div>
<div class="summary-cards" id="summaryCards" style="display: none;">
<div class="card total-revenue">
<div class="card-icon"><i class="fas fa-coins"></i></div>
<div class="card-content">
<h3>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</h3>
<p class="value" id="totalRevenue">0 ‚ÇΩ</p>
<p class="subtitle">–∑–∞ –ø–µ—Ä–∏–æ–¥</p>
</div>
</div>
<div class="card total-orders">
<div class="card-icon"><i class="fas fa-shopping-cart"></i></div>
<div class="card-content">
<h3>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</h3>
<p class="value" id="totalOrders">0</p>
<p class="subtitle">–ø–æ–∑–∏—Ü–∏–π</p>
</div>
</div>
<div class="card avg-check">
<div class="card-icon"><i class="fas fa-file-invoice-dollar"></i></div>
<div class="card-content">
<h3>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</h3>
<p class="value" id="avgCheck">0 ‚ÇΩ</p>
<p class="subtitle">–Ω–∞ –∑–∞–∫–∞–∑</p>
</div>
</div>
<div class="card last-update">
<div class="card-icon"><i class="fas fa-clock"></i></div>
<div class="card-content">
<h3>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h3>
<p class="value" id="lastUpdate">-</p>
<p class="subtitle">–¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</p>
</div>
</div>
</div>
<div class="charts-container" id="chartsContainer" style="display: none;">
<div class="chart-box" data-widget="trend" style="width: 100%; min-height: 400px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<h2><i class="fas fa-chart-area"></i> –î–∏–Ω–∞–º–∏–∫–∞ –≤—ã—Ä—É—á–∫–∏</h2>
<div class="trend-controls">
<select id="trendPeriod">
<option value="all">–í–µ—Å—å –ø–µ—Ä–∏–æ–¥</option>
<option value="7">7 –¥–Ω–µ–π</option>
<option value="30">30 –¥–Ω–µ–π</option>
</select>
</div>
<div class="chart-container"><canvas id="trendChart"></canvas></div>
<div class="trend-legend">
<div class="trend-legend-item"><div class="trend-legend-color up"></div><span>–†–æ—Å—Ç</span></div>
<div class="trend-legend-item"><div class="trend-legend-color down"></div><span>–°–ø–∞–¥</span></div>
</div>
<div class="resize-handle se"></div>
</div>
<div class="chart-box" data-widget="type" style="width: 100%; min-height: 400px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<h2><i class="fas fa-chart-bar"></i> –í—ã—Ä—É—á–∫–∞ –ø–æ —Ç–∏–ø–∞–º</h2>
<div class="chart-container"><canvas id="typeChart"></canvas></div>
<div class="resize-handle se"></div>
</div>
<div class="chart-box" data-widget="orders" style="width: 100%; min-height: 400px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<h2><i class="fas fa-chart-pie"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</h2>
<div class="chart-container"><canvas id="ordersChart"></canvas></div>
<div class="resize-handle se"></div>
</div>
<div class="chart-box" data-widget="top" style="width: 100%; min-height: 400px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<h2><i class="fas fa-trophy"></i> –¢–æ–ø-5 –∑–∞–∫–∞–∑–æ–≤</h2>
<div class="chart-container"><canvas id="topOrdersChart"></canvas></div>
<div class="resize-handle se"></div>
</div>
<div class="chart-box" data-widget="progress" style="width: 100%; min-height: 300px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<h2><i class="fas fa-tasks"></i> –ü—Ä–æ–≥—Ä–µ—Å—Å</h2>
<div id="progressBars"></div>
<div class="resize-handle se"></div>
</div>
<div class="calendar-widget" data-widget="calendar" style="width: 100%; min-height: 450px;">
<div class="widget-controls">
<button class="control-btn" title="–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä" onclick="resetWidgetSize(this)"><i class="fas fa-compress"></i></button>
</div>
<div class="calendar-header">
<div class="calendar-title"><i class="fas fa-calendar-alt"></i><span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></div>
<div id="currentDateDisplay"></div>
</div>
<div class="calendar-stats">
<div class="stat-item"><div class="stat-value" id="totalHoursWorked">0—á</div><div class="stat-label">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ</div></div>
<div class="stat-item"><div class="stat-value" id="totalWorkingDays">0</div><div class="stat-label">–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</div></div>
</div>
<div class="calendar-grid" id="calendarGrid"></div>
<div class="calendar-legend">
<div class="legend-item"><div class="legend-box loaded"></div><span>–ó–∞–≥—Ä—É–∂–µ–Ω–æ (8—á)</span></div>
<div class="legend-item"><div class="legend-box weekend"></div><span>–í—ã—Ö–æ–¥–Ω–æ–π</span></div>
<div class="legend-item"><div class="legend-box holiday"></div><span>–ü—Ä–∞–∑–¥–Ω–∏–∫</span></div>
</div>
<div class="resize-handle se"></div>
</div>
</div>
<div class="history-section" id="historySection" style="display: none;">
<h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫</h2>
<button class="reset-button" id="resetAllButton"><i class="fas fa-trash-alt"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
<div class="history-list" id="historyList"></div>
</div>
<div class="data-table" id="dataTable" style="display: none;">
<h2><i class="fas fa-table"></i> –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</h2>
<div class="table-controls">
<div class="search-box">
<i class="fas fa-search"></i>
<input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫...">
</div>
<div class="filters">
<select id="typeFilter"><option value="">–í—Å–µ —Ç–∏–ø—ã</option></select>
<select id="dateFilter"><option value="">–í—Å–µ –¥–∞—Ç—ã</option></select>
</div>
</div>
<div class="table-wrapper">
<table>
<thead>
<tr><th>‚Ññ</th><th>–ö–æ–¥</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><th>–¢–∏–ø</th><th>–î–∞—Ç–∞</th><th>–°—É–º–º–∞</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</th></tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>
<footer><p>üìä –î–∞—à–±–æ—Ä–¥ &copy; 2026</p></footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const chartsContainer = document.getElementById('chartsContainer');
const summaryCards = document.getElementById('summaryCards');
const historySection = document.getElementById('historySection');
const dataTable = document.getElementById('dataTable');
const errorMessage = document.getElementById('errorMessage');
const errorList = document.getElementById('errorList');
const resetAllButton = document.getElementById('resetAllButton');
let allFilesData = [];
let allOrders = [];
let trendChartInstance = null;
let orderComments = {};
const holidays2026 = { '01': [1,2,3,4,5,6,7,8], '02': [23], '03': [8], '05': [1,9], '06': [12], '11': [4] };

function formatCurrency(n) {
return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(n).replace('RUB', '‚ÇΩ');
}
function formatNumber(n) { return new Intl.NumberFormat('ru-RU').format(Math.round(n)); }
function showError(msg) {
errorList.innerHTML = `<li>${msg}</li>`;
errorMessage.classList.add('show');
setTimeout(() => errorMessage.classList.remove('show'), 6000);
}
function hideError() { errorMessage.classList.remove('show'); }
function showToast(message, type = 'success') {
const existing = document.querySelector('.toast');
if (existing) existing.remove();
const toast = document.createElement('div');
toast.className = `toast ${type}`;
toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>${message}`;
document.body.appendChild(toast);
setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
}
function escapeHtml(text) {
const div = document.createElement('div');
div.textContent = text;
return div.innerHTML;
}
function generateOrderId(order) {
return `${order.sourceFile}_${order.number}_${order.code}`.replace(/\s+/g, '_');
}
function loadComments() {
try {
const saved = localStorage.getItem('orderComments');
if (saved) orderComments = JSON.parse(saved);
} catch (e) { orderComments = {}; }
}
function saveComments() {
try { localStorage.setItem('orderComments', JSON.stringify(orderComments)); } catch (e) {}
}
function getOrderComments(order) { return orderComments[generateOrderId(order)] || []; }
function addComment(order, text, priority = 'normal') {
const orderId = generateOrderId(order);
const comment = { id: Date.now().toString(36), text: text.trim(), priority, author: '–í—ã', timestamp: new Date().toISOString() };
if (!orderComments[orderId]) orderComments[orderId] = [];
orderComments[orderId].push(comment);
saveComments();
return comment;
}
function deleteComment(order, commentId) {
const orderId = generateOrderId(order);
if (orderComments[orderId]) {
orderComments[orderId] = orderComments[orderId].filter(c => c.id !== commentId);
if (orderComments[orderId].length === 0) delete orderComments[orderId];
saveComments();
return true;
}
return false;
}
function formatCommentTime(isoString) {
const date = new Date(isoString);
const now = new Date();
if (date.toDateString() === now.toDateString()) return date.toLocaleTimeString('ru-RU', {hour:'2-digit',minute:'2-digit'});
const yesterday = new Date(now); yesterday.setDate(yesterday.getDate() - 1);
if (date.toDateString() === yesterday.toDateString()) return '–í—á–µ—Ä–∞';
if (now - date < 7 * 24 * 60 * 60 * 1000) return date.toLocaleDateString('ru-RU', {weekday:'short'});
return date.toLocaleDateString('ru-RU', {day:'2-digit',month:'short'});
}
function updateSummaryCards() {
const revenue = allOrders.reduce((s, o) => s + o.amount, 0);
const count = allOrders.length;
const avg = count ? revenue / count : 0;
document.getElementById('totalRevenue').textContent = formatCurrency(revenue);
document.getElementById('totalOrders').textContent = formatNumber(count);
document.getElementById('avgCheck').textContent = formatCurrency(avg);
if (allFilesData.length) {
const latest = allFilesData.map(f => f.exportDateTime).sort().pop();
document.getElementById('lastUpdate').textContent = latest || '-';
}
}
function saveDataToLocalStorage() {
try { localStorage.setItem('dashboardData', JSON.stringify({ allFilesData, allOrders, timestamp: Date.now() })); } catch (e) {}
}
function loadDataFromLocalStorage() {
try {
const saved = localStorage.getItem('dashboardData');
if (saved) {
const { allFilesData: savedFiles, allOrders: savedOrders } = JSON.parse(saved);
if (savedFiles?.length) { allFilesData = savedFiles; allOrders = savedOrders || []; updateUI(); return true; }
}
} catch (e) {}
return false;
}
function updateUI() {
updateSummaryCards();
renderCharts();
renderProgressBars();
renderDataTable();
updateHistoryList();
renderCalendar();
chartsContainer.style.display = 'grid';
summaryCards.style.display = 'grid';
historySection.style.display = 'block';
dataTable.style.display = 'block';
}
function resetUI() {
chartsContainer.style.display = 'none';
summaryCards.style.display = 'none';
historySection.style.display = 'none';
dataTable.style.display = 'none';
document.getElementById('tableBody').innerHTML = '';
document.getElementById('historyList').innerHTML = '';
}
function renderCalendar() {
const now = new Date();
const currentYear = now.getFullYear();
const currentMonth = now.getMonth();
const today = now.getDate();
const monthNames = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
document.getElementById('currentDateDisplay').textContent = `${monthNames[currentMonth]} ${currentYear}`;
const loadedDates = new Set();
allFilesData.forEach(file => {
const dateMatch = file.date.match(/(\d{2})\.(\d{2})\.(\d{4})/);
if (dateMatch) {
const [_, day, month, year] = dateMatch;
if (parseInt(year) === currentYear && parseInt(month) === currentMonth + 1) loadedDates.add(parseInt(day));
}
});
document.getElementById('totalHoursWorked').textContent = `${loadedDates.size * 8}—á`;
const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
let workingDays = 0;
for (let day = 1; day <= daysInMonth; day++) {
const date = new Date(currentYear, currentMonth, day);
const dayOfWeek = date.getDay();
const monthStr = String(currentMonth + 1).padStart(2, '0');
const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
const isHoliday = holidays2026[monthStr] && holidays2026[monthStr].includes(day);
if (!isWeekend && !isHoliday) workingDays++;
}
document.getElementById('totalWorkingDays').textContent = workingDays;
const grid = document.getElementById('calendarGrid');
grid.innerHTML = '';
['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(h => {
const div = document.createElement('div');
div.className = 'calendar-day-header';
div.textContent = h;
grid.appendChild(div);
});
const firstDay = new Date(currentYear, currentMonth, 1).getDay();
const startingDay = firstDay === 0 ? 6 : firstDay - 1;
for (let i = 0; i < startingDay; i++) {
const div = document.createElement('div');
div.className = 'calendar-day empty';
grid.appendChild(div);
}
for (let day = 1; day <= daysInMonth; day++) {
const div = document.createElement('div');
div.className = 'calendar-day';
div.textContent = day;
const date = new Date(currentYear, currentMonth, day);
const dayOfWeek = date.getDay();
const monthStr = String(currentMonth + 1).padStart(2, '0');
const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
const isHoliday = holidays2026[monthStr] && holidays2026[monthStr].includes(day);
const isLoaded = loadedDates.has(day);
const isToday = day === today;
if (isToday) div.classList.add('today');
if (isWeekend) div.classList.add('weekend');
if (isHoliday) div.classList.add('holiday');
if (isLoaded) div.classList.add('loaded');
grid.appendChild(div);
}
}
function renderCharts() {
renderTrendChart();
renderTypeChart();
renderOrdersChart();
renderTopOrdersChart();
}
function renderTrendChart() {
const period = document.getElementById('trendPeriod').value;
const revenueByDate = {};
allOrders.forEach(order => { if (!revenueByDate[order.date]) revenueByDate[order.date] = 0; revenueByDate[order.date] += order.amount; });
const sortedDates = Object.keys(revenueByDate).sort((a, b) => new Date(a.split('.').reverse().join('-')) - new Date(b.split('.').reverse().join('-')));
let filteredDates = sortedDates;
if (period !== 'all') {
const cutoff = new Date(); cutoff.setDate(cutoff.getDate() - parseInt(period));
filteredDates = sortedDates.filter(d => new Date(d.split('.').reverse().join('-')) >= cutoff);
}
const labels = filteredDates;
const values = filteredDates.map(d => revenueByDate[d]);
const ctx = document.getElementById('trendChart').getContext('2d');
const gradient = ctx.createLinearGradient(0, 0, 0, 400);
gradient.addColorStop(0, 'rgba(52, 211, 153, 0.5)');
gradient.addColorStop(1, 'rgba(52, 211, 153, 0.0)');
if (trendChartInstance) trendChartInstance.destroy();
trendChartInstance = new Chart(ctx, {
type: 'line',
data: { labels, datasets: [{ label: '–í—ã—Ä—É—á–∫–∞', data: values, borderColor: '#34d399', backgroundColor: gradient, borderWidth: 3, pointBackgroundColor: values.map((v, i) => i === 0 ? '#34d399' : values[i] >= values[i-1] ? '#34d399' : '#f87171'), pointBorderColor: '#1e293b', pointBorderWidth: 2, pointRadius: 6, pointHoverRadius: 8, fill: true, tension: 0.4 }] },
options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(30,41,59,0.95)', titleColor: '#f8fafc', bodyColor: '#f8fafc', callbacks: { label: ctx => `üí∞ ${formatCurrency(ctx.parsed.y)}` } } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(148,163,184,0.1)' }, ticks: { callback: v => formatCurrency(v), color: '#94a3b8' } }, x: { grid: { display: false }, ticks: { color: '#94a3b8', maxRotation: 45, minRotation: 45 } } } }
});
}
function renderTypeChart() {
const data = {};
allOrders.forEach(o => { data[o.type] = (data[o.type] || 0) + o.amount; });
const labels = Object.keys(data);
const values = Object.values(data);
const total = values.reduce((a,b) => a+b, 0);
const ctx = document.getElementById('typeChart').getContext('2d');
if (Chart.getChart(ctx)) Chart.getChart(ctx).destroy();
const colors = ['rgba(52,211,153,0.8)','rgba(34,211,238,0.8)','rgba(167,139,250,0.8)','rgba(251,191,36,0.8)','rgba(248,113,113,0.8)','rgba(99,102,241,0.8)'];
new Chart(ctx, {
type: 'bar',
 { labels, datasets: [{ label: '–í—ã—Ä—É—á–∫–∞',  values, backgroundColor: labels.map((_, i) => colors[i % colors.length]), borderColor: labels.map((_, i) => colors[i % colors.length].replace('0.8','1')), borderWidth: 2, borderRadius: 8, borderSkipped: false }] },
options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(30,41,59,0.95)', titleColor: '#f8fafc', bodyColor: '#f8fafc', callbacks: { label: ctx => { const pct = ((ctx.parsed.y / total) * 100).toFixed(1); return `${formatCurrency(ctx.parsed.y)} (${pct}%)`; } } } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(148,163,184,0.1)' }, ticks: { callback: v => formatCurrency(v), color: '#94a3b8' } }, x: { grid: { color: 'rgba(148,163,184,0.1)' }, ticks: { color: '#94a3b8' } } } }
});
}
function renderOrdersChart() {
const counts = {};
allOrders.forEach(o => counts[o.type] = (counts[o.type] || 0) + 1);
const ctx = document.getElementById('ordersChart').getContext('2d');
if (Chart.getChart(ctx)) Chart.getChart(ctx).destroy();
const colors = ['#34d399','#22d3ee','#a78bfa','#fbbf24','#f87171','#6366f1'];
new Chart(ctx, {
type: 'doughnut',
 { labels: Object.keys(counts), datasets: [{  Object.values(counts), backgroundColor: Object.keys(counts).map((_, i) => colors[i % colors.length]), borderColor: '#1e293b', borderWidth: 3, hoverOffset: 10 }] },
options: { responsive: true, maintainAspectRatio: false, cutout: '65%', plugins: { legend: { position: 'right', labels: { padding: 15, color: '#f8fafc', font: { size: 12 } } }, tooltip: { backgroundColor: 'rgba(30,41,59,0.95)', titleColor: '#f8fafc', bodyColor: '#f8fafc', callbacks: { label: ctx => { const total = ctx.dataset.data.reduce((a,b) => a+b, 0); const pct = ((ctx.parsed / total) * 100).toFixed(1); return `${ctx.label}: ${ctx.parsed} (${pct}%)`; } } } } }
});
const filter = document.getElementById('typeFilter');
filter.innerHTML = '<option value="">–í—Å–µ —Ç–∏–ø—ã —Ä–∞–±–æ—Ç</option>';
Object.keys(counts).forEach(type => { const opt = document.createElement('option'); opt.value = type; opt.textContent = `${type} (${counts[type]})`; filter.appendChild(opt); });
}
function renderTopOrdersChart() {
const top = [...allOrders].sort((a,b) => b.amount - a.amount).slice(0, 5);
const ctx = document.getElementById('topOrdersChart').getContext('2d');
if (Chart.getChart(ctx)) Chart.getChart(ctx).destroy();
const colors = ['rgba(52,211,153,0.9)','rgba(34,211,238,0.9)','rgba(167,139,250,0.9)','rgba(251,191,36,0.9)','rgba(236,72,153,0.9)'];
new Chart(ctx, {
type: 'bar',
data: { labels: top.map(o => o.description.length > 25 ? o.description.slice(0,25)+'‚Ä¶' : o.description), datasets: [{ label: '–°—É–º–º–∞', data: top.map(o => o.amount), backgroundColor: top.map((_, i) => colors[i]), borderColor: top.map((_, i) => colors[i].replace('0.9','1')), borderWidth: 2, borderRadius: 8, borderSkipped: false }] },
options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { backgroundColor: 'rgba(30,41,59,0.95)', titleColor: '#f8fafc', bodyColor: '#f8fafc', callbacks: { title: items => top[items[0].dataIndex].description, label: ctx => `üí∞ ${formatCurrency(ctx.parsed.x)}` } } }, scales: { x: { grid: { color: 'rgba(148,163,184,0.1)' }, ticks: { callback: v => formatCurrency(v), color: '#94a3b8' } }, y: { grid: { display: false }, ticks: { color: '#94a3b8' } } } }
});
}
function renderProgressBars() {
const container = document.getElementById('progressBars');
container.innerHTML = '';
const revenue = allOrders.reduce((s,o) => s + o.amount, 0);
const count = allOrders.length;
const targetRev = 5000 * allFilesData.length;
const targetOrd = 20 * allFilesData.length;
createProgress(container, '–í—ã—Ä—É—á–∫–∞', revenue, targetRev, '‚ÇΩ', '#34d399');
createProgress(container, '–ó–∞–∫–∞–∑—ã', count, targetOrd, '', '#10b981');
const types = {}; allOrders.forEach(o => types[o.type] = (types[o.type]||0)+1);
const topType = Object.entries(types).sort((a,b) => b[1]-a[1])[0];
if (topType) createProgress(container, `–¢–∏–ø "${topType[0]}"`, topType[1], Math.max(topType[1]*1.5, 10), '', '#22d3ee');
}
function createProgress(container, title, current, target, unit, color) {
const pct = Math.min((current/target)*100, 100);
const el = document.createElement('div');
el.className = 'progress-group';
el.innerHTML = `<div class="progress-header"><span class="progress-title">${title}</span><span class="progress-value">${formatNumber(current)}${unit} / ${formatNumber(target)}${unit}</span></div><div class="progress"><div class="progress-fill" style="width: ${pct}%; background: ${color}"></div></div>`;
container.appendChild(el);
}
function renderDataTable() {
const tbody = document.getElementById('tableBody');
tbody.innerHTML = '';
allOrders.forEach(order => {
const orderId = generateOrderId(order);
const comments = orderComments[orderId] || [];
const hasComments = comments.length > 0;
const tr = document.createElement('tr');
tr.innerHTML = `<td>${order.number}</td><td><strong>${order.code}</strong></td><td title="${order.description}">${order.description.slice(0,35)}${order.description.length>35?'‚Ä¶':''}</td><td><span style="background:var(--bg-tertiary);padding:4px 10px;border-radius:20px;font-size:0.85rem">${order.type}</span></td><td>${order.date}</td><td class="amount-cell">${formatCurrency(order.amount)}</td><td class="comment-cell"><button class="comment-btn ${hasComments ? 'has-comment' : ''}" data-order-id="${orderId}" title="${hasComments ? `${comments.length} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π(–µ–≤)` : '–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'}" onclick="openCommentsModal(${JSON.stringify(order).replace(/"/g, '&quot;')})"><i class="fas fa-comment"></i>${hasComments ? `<span class="comment-count">${comments.length}</span>` : ''}</button></td>`;
tbody.appendChild(tr);
});
const dates = [...new Set(allOrders.map(o => o.date))].sort();
const dateFilter = document.getElementById('dateFilter');
dateFilter.innerHTML = '<option value="">–í—Å–µ –¥–∞—Ç—ã</option>';
dates.forEach(d => { const opt = document.createElement('option'); opt.value = d; opt.textContent = d; dateFilter.appendChild(opt); });
}
function filterTable() {
const search = document.getElementById('searchInput').value.toLowerCase();
const type = document.getElementById('typeFilter').value;
const date = document.getElementById('dateFilter').value;
document.querySelectorAll('#tableBody tr').forEach(row => {
const cells = row.cells;
const match = (!search || cells[2].textContent.toLowerCase().includes(search) || cells[1].textContent.toLowerCase().includes(search)) && (!type || cells[3].textContent === type) && (!date || cells[4].textContent === date);
row.style.display = match ? '' : 'none';
});
}
function updateHistoryList() {
const list = document.getElementById('historyList');
list.innerHTML = '';
[...allFilesData].reverse().forEach(file => {
const item = document.createElement('div');
item.className = 'history-item';
item.innerHTML = `<div class="history-item-icon"><i class="fas fa-file-lines"></i></div><div class="history-item-details"><h4>${file.fileName}</h4><p><i class="far fa-clock"></i> ${file.exportDateTime} ‚Ä¢ <i class="fas fa-coins"></i> ${formatCurrency(file.total)}</p></div><div class="history-item-actions"><button class="btn-remove" data-file="${file.fileName}" title="–£–¥–∞–ª–∏—Ç—å"><i class="fas fa-xmark"></i></button></div>`;
list.appendChild(item);
});
document.querySelectorAll('.btn-remove').forEach(btn => {
btn.onclick = () => {
const name = btn.dataset.file;
allFilesData = allFilesData.filter(f => f.fileName !== name);
allOrders = allFilesData.flatMap(f => f.orders);
Object.keys(orderComments).forEach(orderId => { if (orderId.includes(name)) delete orderComments[orderId]; });
saveComments();
updateUI();
saveDataToLocalStorage();
};
});
}
function handleFile(file) {
if (!file.name.endsWith('.txt')) { showError('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª .txt'); return; }
const reader = new FileReader();
reader.onload = e => {
try {
hideError();
const fileData = parseOrderFile(e.target.result, file.name);
if (allFilesData.some(f => f.fileName === file.name)) { showError('–§–∞–π–ª —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω'); return; }
allFilesData.push(fileData);
allOrders = allFilesData.flatMap(f => f.orders);
updateUI();
saveDataToLocalStorage();
fileInput.value = '';
} catch (err) { showError(`–û—à–∏–±–∫–∞: ${err.message}`); }
};
reader.onerror = () => showError('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª');
reader.readAsText(file, 'utf-8');
}
function parseOrderFile(content, fileName) {
let date = fileName.match(/(\d{2}\.\d{2}\.\d{4})/)?.[1] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
const contentDate = content.match(/–ó–ê–ö–ê–ó–´ –ó–ê (\d{2}\.\d{2}\.\d{4})/);
if (contentDate) date = contentDate[1];
const exportMatch = content.match(/–≠–∫—Å–ø–æ—Ä—Ç: ([\d.,:\s]+)/);
const exportDateTime = exportMatch ? exportMatch[1].trim() : new Date().toLocaleString('ru-RU');
const orders = [];
const sections = content.split('---');
for (const section of sections) {
const lines = section.trim().split('\n').filter(l => l.trim());
if (lines.length < 2) continue;
const numMatch = lines[0].match(/‚Ññ(\d+)\.\s*(.+)/);
if (!numMatch) continue;
const order = { number: numMatch[1], code: numMatch[2].trim(), description: '', type: '', amount: 0, date, sourceFile: fileName, parameters: {} };
if (lines[1]) {
const descMatch = lines[1].match(/([^(]+)\s*(?:\(([^)]+)\))?/);
if (descMatch) { order.description = descMatch[1].trim(); order.type = descMatch[2]?.trim() || '–ë–µ–∑ —Ç–∏–ø–∞'; }
}
for (let i = 2; i < lines.length; i++) {
const line = lines[i].trim();
if (line.startsWith('–î–ª–∏–Ω–∞:')) order.parameters['–î–ª–∏–Ω–∞'] = parseFloat(line.match(/[\d.,]+/)?.[0]?.replace(',', '.'));
if (line.startsWith('–®–∏—Ä–∏–Ω–∞:')) order.parameters['–®–∏—Ä–∏–Ω–∞'] = parseFloat(line.match(/[\d.,]+/)?.[0]?.replace(',', '.'));
if (line.startsWith('–ö–æ–ª-–≤–æ:')) order.parameters['–ö–æ–ª-–≤–æ'] = parseInt(line.match(/\d+/)?.[0]);
if (line.startsWith('–û–±—ä–µ–º:')) {
const vol = line.replace('–û–±—ä–µ–º:', '').trim();
const val = parseFloat(vol.match(/[\d.,]+/)?.[0]?.replace(',', '.'));
if (vol.includes('–º¬≤') || vol.includes('–∫–≤.–º')) order.parameters['–ö–≤.–º'] = val;
else if (vol.includes('–ø–æ–≥.–º')) order.parameters['–ü–æ–≥.–º'] = val;
}
if (line.startsWith('–°—É–º–º–∞:')) { const sum = line.match(/[\d.,]+/)?.[0]?.replace(',', '.'); if (sum) order.amount = parseFloat(sum); }
}
if (!order.amount) { const lastSum = content.match(/–°—É–º–º–∞:\s*([\d.,]+)/); if (lastSum) order.amount = parseFloat(lastSum[1].replace(',', '.')); }
if (order.description) orders.push(order);
}
const totalMatch = content.match(/–ò–¢–û–ì–û:\s*([\d.,]+)/);
const total = totalMatch ? parseFloat(totalMatch[1].replace(',', '.')) : orders.reduce((s, o) => s + (o.amount || 0), 0);
return { orders, total, date, exportDateTime, fileName };
}
window.resizeWidget = function(btn, delta) {
const widget = btn.closest('.chart-box, .calendar-widget');
if (!widget) return;
const currentWidth = widget.offsetWidth;
const newWidth = Math.max(300, currentWidth + delta * 100);
widget.style.width = newWidth + 'px';
setTimeout(() => {
const canvas = widget.querySelector('canvas');
if (canvas) { const chart = Chart.getChart(canvas); if (chart) chart.resize(); }
}, 300);
saveLayout();
};
window.resetWidgetSize = function(btn) {
const widget = btn.closest('.chart-box, .calendar-widget');
if (!widget) return;
widget.style.width = '100%';
widget.style.minHeight = '';
setTimeout(() => {
const canvas = widget.querySelector('canvas');
if (canvas) { const chart = Chart.getChart(canvas); if (chart) chart.resize(); }
}, 300);
saveLayout();
};
function initResizeHandles() {
document.querySelectorAll('.resize-handle').forEach(handle => {
handle.addEventListener('mousedown', initResize);
});
}
function initResize(e) {
e.preventDefault();
e.stopPropagation();
const widget = this.parentElement;
const startX = e.clientX;
const startY = e.clientY;
const startWidth = widget.offsetWidth;
const startHeight = widget.offsetHeight;
widget.classList.add('resizing');
const minWidth = 300;
const minHeight = 300;
function doResize(e) {
const newWidth = Math.max(minWidth, startWidth + (e.clientX - startX));
const newHeight = Math.max(minHeight, startHeight + (e.clientY - startY));
widget.style.width = newWidth + 'px';
widget.style.height = newHeight + 'px';
const canvas = widget.querySelector('canvas');
if (canvas) { const chart = Chart.getChart(canvas); if (chart) chart.resize(); }
}
function stopResize() {
widget.classList.remove('resizing');
document.removeEventListener('mousemove', doResize);
document.removeEventListener('mouseup', stopResize);
saveLayout();
}
document.addEventListener('mousemove', doResize);
document.addEventListener('mouseup', stopResize);
}
function saveLayout() {
const layout = [];
document.querySelectorAll('.chart-box, .calendar-widget').forEach((widget, index) => {
layout.push({ id: widget.dataset.widget || index, width: widget.style.width, height: widget.style.height, order: index });
});
localStorage.setItem('dashboardLayout', JSON.stringify(layout));
}
function loadLayout() {
const saved = localStorage.getItem('dashboardLayout');
if (saved) {
const layout = JSON.parse(saved);
layout.forEach(item => {
const widget = document.querySelector(`[data-widget="${item.id}"]`);
if (widget) {
if (item.width) widget.style.width = item.width;
if (item.height) widget.style.height = item.height;
}
});
}
}
function openCommentsModal(order) {
const modal = document.createElement('div');
modal.className = 'modal-overlay';
modal.innerHTML = `<div class="modal" style="background:var(--bg-secondary);border-radius:16px;box-shadow:var(--shadow-lg);width:100%;max-width:520px;max-height:85vh;display:flex;flex-direction:column;border:1px solid var(--border);"><div class="modal-header" style="padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;"><h3 style="font-size:1.1rem;"><i class="fas fa-comments"></i> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3><button class="modal-close" style="width:36px;height:36px;border-radius:10px;border:none;background:var(--bg-tertiary);cursor:pointer;"><i class="fas fa-times"></i></button></div><div class="modal-order-info" style="padding:12px 24px;background:var(--bg-tertiary);font-size:0.9rem;border-bottom:1px solid var(--border);"><strong>–ó–∞–∫–∞–∑ ‚Ññ${order.number}</strong> ‚Ä¢ ${order.code}<br>${order.description} ‚Ä¢ ${formatCurrency(order.amount)}</div><div class="modal-body" style="padding:20px 24px;overflow-y:auto;flex:1;"><div class="comments-list" id="commentsList"></div><div class="comment-form" style="display:flex;flex-direction:column;gap:12px;padding-top:16px;border-top:1px solid var(--border);"><textarea id="commentInput" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="width:100%;min-height:80px;padding:12px 14px;border:2px solid var(--border);border-radius:12px;background:var(--bg-tertiary);color:var(--text-primary);resize:vertical;"></textarea><div class="comment-form-controls" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;"><div class="comment-priority-select" style="display:flex;gap:6px;"><button class="priority-btn normal active" data-priority="normal" style="padding:6px 12px;border:2px solid var(--border);border-radius:20px;background:var(--bg-tertiary);cursor:pointer;"><i class="fas fa-circle"></i> –û–±—ã—á–Ω—ã–π</button><button class="priority-btn important" data-priority="important" style="padding:6px 12px;border:2px solid var(--border);border-radius:20px;background:var(--bg-tertiary);cursor:pointer;color:var(--warning);"><i class="fas fa-exclamation"></i> –í–∞–∂–Ω–æ</button><button class="priority-btn urgent" data-priority="urgent" style="padding:6px 12px;border:2px solid var(--border);border-radius:20px;background:var(--bg-tertiary);cursor:pointer;color:var(--danger);"><i class="fas fa-bolt"></i> –°—Ä–æ—á–Ω–æ</button></div><button class="comment-submit" id="commentSubmit" style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#020617;border:none;padding:10px 24px;border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:8px;"><i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div></div></div></div>`;
document.body.appendChild(modal);
const commentsList = modal.querySelector('#commentsList');
const commentInput = modal.querySelector('#commentInput');
const commentSubmit = modal.querySelector('#commentSubmit');
const priorityBtns = modal.querySelectorAll('.priority-btn');
const modalClose = modal.querySelector('.modal-close');
let selectedPriority = 'normal';
priorityBtns.forEach(btn => {
btn.onclick = () => { priorityBtns.forEach(b => b.classList.remove('active')); btn.classList.add('active'); selectedPriority = btn.dataset.priority; };
});
function renderComments() {
const comments = getOrderComments(order);
if (comments.length === 0) { commentsList.innerHTML = `<div class="empty-comments" style="text-align:center;padding:30px;color:var(--text-tertiary);"><i class="fas fa-comment-slash" style="font-size:40px;margin-bottom:12px;opacity:0.5;"></i><p>–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p></div>`; return; }
commentsList.innerHTML = comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(comment => `<div class="comment-item ${comment.priority}" data-id="${comment.id}" style="background:var(--bg-tertiary);border-radius:12px;padding:14px 16px;margin-bottom:12px;border-left:3px solid ${comment.priority==='urgent'? 'var(--danger)' : comment.priority==='important'? 'var(--warning)' : 'var(--primary)'};"><div class="comment-header" style="display:flex;justify-content:space-between;margin-bottom:8px;"><div class="comment-author" style="font-weight:500;"><i class="fas fa-user-circle" style="color:var(--primary);margin-right:6px;"></i>${comment.author}${comment.priority !== 'normal' ? `<span style="margin-left:8px;padding:3px 8px;border-radius:20px;font-size:0.75rem;background:${comment.priority==='urgent'? 'rgba(248,113,113,0.15)' : 'rgba(251,191,36,0.15)'};color:${comment.priority==='urgent'? 'var(--danger)' : 'var(--warning)'}">${comment.priority==='urgent'? '–°—Ä–æ—á–Ω–æ' : '–í–∞–∂–Ω–æ'}</span>` : ''}</div><span class="comment-time" style="font-size:0.8rem;color:var(--text-tertiary);">${formatCommentTime(comment.timestamp)}</span></div><div class="comment-text" style="color:var(--text-secondary);white-space:pre-wrap;">${escapeHtml(comment.text)}</div><div class="comment-actions" style="display:flex;gap:8px;margin-top:10px;padding-top:10px;border-top:1px dashed var(--border);"><button class="comment-action-btn copy" data-text="${escapeHtml(comment.text)}" style="background:none;border:none;cursor:pointer;padding:4px 8px;border-radius:6px;font-size:0.85rem;"><i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button><button class="comment-action-btn delete" style="background:none;border:none;cursor:pointer;padding:4px 8px;border-radius:6px;font-size:0.85rem;color:var(--danger);"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å</button></div></div>`).join('');
commentsList.querySelectorAll('.delete').forEach(btn => { btn.onclick = () => { const commentItem = btn.closest('.comment-item'); const commentId = commentItem.dataset.id; if (confirm('–£–¥–∞–ª–∏—Ç—å?')) { deleteComment(order, commentId); renderComments(); updateCommentButton(order); showToast('–£–¥–∞–ª—ë–Ω', 'success'); } }; });
commentsList.querySelectorAll('.copy').forEach(btn => { btn.onclick = () => { navigator.clipboard.writeText(btn.dataset.text); showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', 'success'); }; });
}
commentSubmit.onclick = () => { const text = commentInput.value.trim(); if (!text) { commentInput.focus(); return; } addComment(order, text, selectedPriority); commentInput.value = ''; priorityBtns.forEach(b => b.classList.remove('active')); priorityBtns[0].classList.add('active'); selectedPriority = 'normal'; renderComments(); updateCommentButton(order); showToast('–î–æ–±–∞–≤–ª–µ–Ω', 'success'); commentInput.focus(); };
commentInput.addEventListener('keydown', (e) => { if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); commentSubmit.click(); } });
modalClose.onclick = closeModal;
modal.onclick = (e) => { if (e.target === modal) closeModal(); };
function closeModal() { modal.classList.remove('active'); setTimeout(() => modal.remove(), 300); }
setTimeout(() => modal.classList.add('active'), 10);
renderComments();
commentInput.focus();
}
function updateCommentButton(order) {
const orderId = generateOrderId(order);
const btn = document.querySelector(`[data-order-id="${orderId}"]`);
if (btn) {
const comments = orderComments[orderId] || [];
if (comments.length > 0) { btn.classList.add('has-comment'); btn.innerHTML = `<i class="fas fa-comment"></i><span class="comment-count">${comments.length}</span>`; }
else { btn.classList.remove('has-comment'); btn.innerHTML = `<i class="fas fa-comment"></i>`; }
}
}
dropZone.addEventListener('click', () => fileInput.click());
['dragover','dragenter'].forEach(evt => dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.add('dragover'); }));
['dragleave','drop'].forEach(evt => dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.remove('dragover'); }));
dropZone.addEventListener('drop', e => { if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); });
fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });
resetAllButton.addEventListener('click', () => { if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) { allFilesData = []; allOrders = []; orderComments = {}; localStorage.removeItem('dashboardData'); localStorage.removeItem('orderComments'); localStorage.removeItem('dashboardLayout'); resetUI(); } });
document.getElementById('searchInput').addEventListener('input', filterTable);
document.getElementById('typeFilter').addEventListener('change', filterTable);
document.getElementById('dateFilter').addEventListener('change', filterTable);
document.getElementById('trendPeriod').addEventListener('change', () => renderTrendChart());
loadComments();
window.openCommentsModal = openCommentsModal;
if (!loadDataFromLocalStorage()) dropZone.style.animation = 'fadeInUp 0.6s ease-out';
setTimeout(() => { initResizeHandles(); loadLayout(); }, 100);
window.addEventListener('resize', () => { setTimeout(() => { document.querySelectorAll('canvas').forEach(canvas => { const chart = Chart.getChart(canvas); if (chart) chart.resize(); }); }, 300); });
});
</script>
</body>
</html>
